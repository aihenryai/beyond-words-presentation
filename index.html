e.code === 'Escape' && fullscreenModal.classList.contains('active')) {
                    closeFullscreen();
                }
                
                // Navigation with arrow keys (RTL adjusted)
                if (e.code === 'ArrowRight' && currentIsland > 1) {
                    navigateToIsland(currentIsland - 1);
                } else if (e.code === 'ArrowLeft' && currentIsland < 4) {
                    navigateToIsland(currentIsland + 1);
                } else if (e.code === 'Equal' || e.code === 'NumpadAdd') {
                    zoomIn();
                } else if (e.code === 'Minus' || e.code === 'NumpadSubtract') {
                    zoomOut();
                } else if (e.code === 'Digit0') {
                    resetZoom();
                }
            });
        }

        // Zoom functions
        function zoomIn() {
            zoomLevel = Math.min(zoomLevel + 0.1, 2);
            updateCanvasPosition();
        }

        function zoomOut() {
            zoomLevel = Math.max(zoomLevel - 0.1, 0.5);
            updateCanvasPosition();
        }

        function resetZoom() {
            zoomLevel = 1;
            updateCanvasPosition();
        }

        // Minimap click navigation
        document.getElementById('minimap').addEventListener('click', (e) => {
            const rect = e.currentTarget.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 5000;
            const y = ((e.clientY - rect.top) / rect.height) * 3000;
            
            canvasPosition.x = -x + window.innerWidth / 2;
            canvasPosition.y = -y + window.innerHeight / 2;
            
            updateCanvasPosition();
            updateMinimap();
        });

        // Start journey function
        function startJourney(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            navigateToIsland(1);
            setTimeout(() => navigateToIsland(2), 2000);
            setTimeout(() => navigateToIsland(3), 4000);
            setTimeout(() => navigateToIsland(4), 6000);
        }

        // Auto-play option
        let autoPlayInterval;
        function toggleAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            } else {
                autoPlayInterval = setInterval(() => {
                    const nextIsland = currentIsland === 4 ? 1 : currentIsland + 1;
                    navigateToIsland(nextIsland);
                }, 8000);
            }
        }

        // Touch support for mobile
        let touchStart = { x: 0, y: 0 };
        
        canvas.addEventListener('touchstart', (e) => {
            touchStart.x = e.touches[0].clientX;
            touchStart.y = e.touches[0].clientY;
            canvasStart.x = canvasPosition.x;
            canvasStart.y = canvasPosition.y;
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const deltaX = e.touches[0].clientX - touchStart.x;
            const deltaY = e.touches[0].clientY - touchStart.y;
            
            canvasPosition.x = canvasStart.x + deltaX;
            canvasPosition.y = canvasStart.y + deltaY;
            
            updateCanvasPosition();
            updateMinimap();
        });

        // Presenter mode keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // F key for fullscreen browser
            if (e.code === 'KeyF' && !e.ctrlKey && !e.altKey && !e.shiftKey) {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
            
            // P key for auto-play toggle
            if (e.code === 'KeyP' && !e.ctrlKey && !e.altKey && !e.shiftKey) {
                toggleAutoPlay();
            }
            
            // Number keys for direct island navigation
            if (e.code === 'Digit1') navigateToIsland(1);
            if (e.code === 'Digit2') navigateToIsland(2);
            if (e.code === 'Digit3') navigateToIsland(3);
            if (e.code === 'Digit4') navigateToIsland(4);
        });
    </script>
</body>
</html>